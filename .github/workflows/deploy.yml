name: Deploy to Railway

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install Railway CLI
        run: |
          curl -sL https://railway.app/install.sh | bash

      - name: Login to Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: railway login --token $RAILWAY_TOKEN

      - name: Trigger Deployment
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          curl --request POST \
            --url https://backboard.railway.com/graphql/v2 \
            --header "Authorization: Bearer $RAILWAY_TOKEN" \
            --header "Content-Type: application/json" \
            --data '{"query": "mutation { deployProject { projectId, environmentId } }"}'

